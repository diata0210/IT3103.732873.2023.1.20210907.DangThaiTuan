VnExpress - Bao tieng Viet nhieu nguoi xem nhatThứ tư, 15/11/2023
Mới nhất
Tin theo khu vực
International

 Đăng nhập
Thời sự
Góc nhìn
Thế giới
Video
Podcasts
Kinh doanh
Bất động sản
Khoa học
Giải trí
Thể thao
Pháp luật
Giáo dục
Sức khỏe
Đời sống
Du lịch
Số hóa
Xe
Ý kiến
Tâm sự
Thư giãn
Tất cả


Nước lũ dâng gây ngập lụt Huế
Nước lũ dâng gây ngập lụt Huế
THỪA THIÊN - HUẾÔng Phùng Anh Tuấn kể lại nước lũ tràn về đột ngột, rất nhanh lên trên mức báo động 3, khiến toàn bộ 36 phường ở TP Huế bị ngập, có khu vực sâu hơn 1 m.


Đội tình báo giúp Israel hạ nhóm tay súng Hamas trong 10 phút
Đội tình báo giúp Israel hạ nhóm tay súng Hamas trong 10 phút
Thủ tướng: Các tỉnh phải tạo điều kiện phát triển kinh tế đêm  11
Thủ tướng: Các tỉnh phải tạo điều kiện phát triển kinh tế đêm
Góc nhìn
Nếu con tôi bị bạn đánh
Tôi luôn bất an khi tự hỏi 'nếu con mình là nạn nhân bạo lực học đường, mình sẽ làm gì'?

Trần Hùng Thiện
 209

Giám đốc Sở Tài nguyên và Môi trường Bà Rịa - Vũng Tàu bị khởi tố
Giám đốc Sở Tài nguyên và Môi trường Bà Rịa - Vũng Tàu bị khởi tố
Ông Nguyễn Văn Hải, Giám đốc Sở Tài nguyên và Môi trường, bị cáo buộc khi làm Phó chủ tịch huyện Đất Đỏ gần 10 năm trước đã giao đất sai pháp luật, gây thiệt hại cho Nhà nước 

Ông Lưu Bình Nhưỡng bị bắt
Ông Lưu Bình Nhưỡng bị bắt
THÁI BÌNHÔng Lưu Bình Nhưỡng, Phó Ban Dân nguyện thuộc Ủy ban Thường vụ Quốc hội, bị cáo buộc vai trò đồng phạm của nhóm giang hồ cưỡng đoạt tiền của nhiều doanh nghiệp khai thác cát.  43

Chiến sự Hamas - Israel
Những ngôi sao đáng chú ý của tuyển Philippines
Những ngôi sao đáng chú ý của tuyển Philippines
Đội tuyển Philippines là tập thể bao gồm nhiều cầu thủ mang dòng máu lai và nhập tịch, với 77% cái tên thi đấu ở nước ngoài. 

Xe cấp cứu chở 6 người gặp nạn
Xe cấp cứu chở 6 người gặp nạn
BÌNH THUẬNXe cấp cứu của Trung tâm Y tế huyện Tuy Phong chở bệnh nhân vào bệnh viện tỉnh gặp nạn trên quốc lộ 1, khiến một người chết, 5 người bị thương nặng, chiều 15/11. 

50 học sinh nhập viện nghi ngộ độc thực phẩm
50 học sinh nhập viện nghi ngộ độc thực phẩm
KIÊN GIANG50 học sinh Trường Tiểu học Trần Văn Ơn và Tiểu học Mạc Đĩnh Chi tại TP Rạch Giá nhập viện khi đau bụng, nôn ói, tụt huyết áp sau bữa trưa tại trường, ngày 15/11. 

Hai người chết, ba người mất tích do mưa lũ
Hai người chết, ba người mất tích do mưa lũ
Mưa lũ ba ngày nay ở Quảng Trị, Thừa Thiên Huế đã cướp đi hai sinh mạng, ba người khác đang chưa tìm thấy tung tích. 

Thiếu 2.500 tỷ cho dự án tái định cư xây sân bay Long Thành
Thiếu 2.500 tỷ cho dự án tái định cư xây sân bay Long Thành
Dự án tái định cư sân bay Long Thành được phân bổ hơn 22.855 tỷ đồng, nhưng tới cuối 2022, 2.500 tỷ chưa giải ngân đã bị hủy dự toán và chưa có nguồn thay thế. 

HLV Philippines 'lên gân' trước trận đấu Việt Nam
HLV Philippines 'lên gân' trước trận đấu Việt Nam
PHILIPPINESHLV Michael Weiss khẳng định đã nghiên cứu kỹ Việt Nam dưới thời Philippe Troussier, và kêu gọi học trò chiến đấu bằng mọi giá ở trận ra quân vòng loại hai World Cup 2026.  45

Phố cổ Hội An ngập nửa mét
Phố cổ Hội An ngập nửa mét
QUẢNG NAMNước lũ dâng cao khiến nhiều tuyến phố ven sông Hoài và hàng trăm nhà cổ ở Hội An ngập nửa mét, là mức ngập lớn nhất từ đầu năm.  22

Nữ tài xế lùi xe vào cửa hàng khiến bảo vệ trọng thương
Nữ tài xế lùi xe vào cửa hàng khiến bảo vệ trọng thương
HẢI PHÒNGChị Nguyễn Mai Anh điều khiển ôtô 5 chỗ lùi vào cửa hàng trang sức song không làm chủ được tốc độ, tông vào bảo vệ đang ngồi trước cửa.  25

Hãng xe Thành Bưởi bị tước giấy phép không thời hạn
Hãng xe Thành Bưởi bị tước giấy phép không thời hạn
Nhà xe Thành Bưởi bị thu giấy phép kinh doanh vận tải bằng ôtô không thời hạn, do cung cấp bản sao không đúng bản chính hoặc thông tin sai lệch trong hồ sơ cấp phép.  69

Không khí lạnh tăng cường, miền Trung tiếp tục mưa lớn
Không khí lạnh tăng cường, miền Trung tiếp tục mưa lớn
Đồng bằng Bắc Bộ lạnh 15-17 độ vào ban đêm, ban ngày nắng 28 độ C; Trung Bộ tiếp tục mưa to tới ngày 17/11 do tác động của không khí lạnh tăng cường. 

Quang Liêm hạ kỳ thủ số bảy thế giới như thế nào
Quang Liêm hạ kỳ thủ số bảy thế giới như thế nào
MỸVới quyết định thí mã, Lê Quang Liêm tạo ra một nước cờ xuất sắc, khi đánh bại kỳ thủ số bảy thế giới Wesley So tại giải nhanh chớp St Louis. 

Ba người bị bắt sau cái chết của 4 du khách Hàn Quốc
Ba người bị bắt sau cái chết của 4 du khách Hàn Quốc
LÂM ĐỒNGÔng Ngô Thanh Nghĩa, Phó giám đốc khu du lịch Làng Cù Lần và 2 nhân viên bị cáo buộc vô ý làm 4 du khách Hàn Quốc tử vong trong lúc chở đi tham quan 

Kinh doanhQuốc tếDoanh nghiệpChứng khoánVĩ môHậu trường kinh doanh
Khối ngoại dứt chuỗi bán ròng
Khối ngoại dứt chuỗi bán ròng
Sau 6 phiên bán ròng, nhà đầu tư nước ngoài trở lại gom hàng khoảng 245 tỷ đồng trong hôm nay khi VN-Index tăng gần 13 điểm. 

'Việt Nam thuộc nhóm sản xuất chủ chốt ở châu Á của Uniqlo'
Với 80 nhà máy đối tác và 240.000 lao động liên quan, Tổng giám đốc Uniqlo nói Việt Nam là một trong ... 

Nhật Bản tăng trưởng âm 10
Thêm nhà mạng gia nhập thị trường từ đầu năm 2024
Hệ lụy khi thế giới thừa pin mặt trời 58
TỶ GIÁ NGOẠI TỆEximbank	Mua TM	Mua CK	Bán
USD/VNĐ	24.060	24.140	24.450
EUR/VNĐ	25.972	26.050	26.696Bất động sảnChính sáchThị trườngDự ánKhông gian sốngTư vấn
Đề xuất cho người nước ngoài mua bất động sản nghỉ dưỡng
Đề xuất cho người nước ngoài mua bất động sản nghỉ dưỡng
Phó tổng giám đốc Sungroup đề xuất người nước ngoài cũng có thể mua bất động sản nghỉ dưỡng, vừa giúp thu hút ...  11

Ngân hàng giảm nửa giá rao bán nhà phố cổ Hà Nội
Sau 7 lần đấu giá không thành, Agribank AMC chào giá 300 triệu đồng một m2 căn nhà mặt đường Hàng Buồm, ...  47

Buông 'rèm gạch' xung quanh nhà để tránh hàng xóm 43
Hệ thống đèn trong nhà nên chọn ánh sáng vàng hay trắng? 32
Novaland được giao một phần đất thuộc Aqua City
Thể thaoBóng đáTennisMarathonLịch thi đấu
Hậu vệ Argentina\: 'Cần đoạt Copa America để Messi dự World Cup 2026'
Hậu vệ Argentina: 'Cần đoạt Copa America để Messi dự World Cup 2026'
ARGENTINATrong bài phỏng vấn trên nhật báo La Nacion, hậu vệ Nicolas Tagliafico tiết lộ về việc anh và các ...  59

HLV Troussier: 'Việt Nam đã hoàn thiện cho vòng loại World Cup'
PHILIPPINESHLV Philippe Troussier tin rằng, qua tám tháng chuẩn bị, tuyển Việt Nam đã sẵn sàng ...  159

Thủ môn Philippines hy vọng tiền đạo Việt Nam tiếp tục tịt ngòi
Nguyễn Văn Toàn: 'Việt Nam có kinh nghiệm đương đầu áp lực' 12
Man City có 84% khả năng vô địch Ngoại hạng Anh 13
Ngày mai, 17:00
Nhật Bản
Nhật Bản
Nhật Bản
Myanmar
Ngày mai, 18:00
Philippines
Philippines
Philippines
Việt Nam
Ngày mai, 18:00
Hàn Quốc
Hàn Quốc
Hàn Quốc
Singapore
Ngày mai, 19:30
Thái Lan
Thái Lan
Thái Lan
Trung Quốc
Ngày mai, 20:00
Malaysia
Malaysia
Malaysia
Kyrgyzstan
Ngày mai, 21:45
Iraq
Iraq
Iraq
Indonesia
Thứ ba, 21/11, 16:30
Myanmar
Myanmar
Myanmar
Triều Tiên
Thứ ba, 21/11, 18:00
Đài Loan
Đài Loan
Đài Loan
Malaysia
Thứ ba, 21/11, 18:00
Philippines
Philippines
Philippines
Indonesia
Thứ ba, 21/11, 19:00
Việt Nam
Việt Nam
Việt Nam
Iraq
Thứ ba, 21/11, 19:00
Singapore
Singapore
Singapore
Thái Lan
Thứ sáu, 24/11, 18:00
Bình Dương
Bình Dương
Bình Dương
Hà Nội
Thứ sáu, 24/11, 22:00
Al-Ettifaq
Al-Ettifaq
Al-Ettifaq
Al-Ittihad FC
Xem tất cả
Giải tríGiới saoPhimNhạcThời trang
Zendaya và Tom Holland - từ bạn thân thành người yêu
Zendaya và Tom Holland - từ bạn thân thành người yêu
"Người nhện" Tom Holland và diễn viên Zendaya thường xuyên thể hiện tình cảm sau ... 

Sách
Sách phê bình đầu tiên về tài thơ của Văn Cao
"Văn Cao mùa chữ, mùa người" là cuốn phê bình đầu tiên về sự nghiệp thơ của nhạc sĩ, ra mắt ... 

Những tiết mục solo gây chú ý tại 'Đạp gió'
Bí quyết giữ đường cong của người tình tỷ phú Jeff Bezos 23
Vé đêm Kpop ở Hà Nội cao nhất 15 triệu đồng 12
Sức khỏeTin tứcDinh dưỡngKhỏe đẹpCác bệnhVaccine
Mổ lấy thai sớm, 2 trẻ sơ sinh nguy kịch
Mổ lấy thai sớm, 2 trẻ sơ sinh nguy kịch
HÀ NỘIMột tuần qua, Bệnh viện Nhi Trung ương tiếp nhận 6 trẻ sinh mổ chủ động gặp các biến chứng nặng phải thở máy, đặc biệt 2 bé tổn ... 

Tổn thương mặt sau trị sẹo ở spa
HÀ NỘISau khi điều trị sẹo lõm bằng laser tại một spa, mặt bệnh nhân nữ 28 tuổi xuất hiện nhiều tổn thương viêm đỏ, phải nhập viện. 

Pháo tự chế phát nổ, bé trai dập nát tay
Chế độ ăn giúp Cher có ngoại hình trẻ trung ở tuổi U80
Dấu hiệu trẻ bệnh nên nghỉ học
Cẩm nang các bệnh:
Hô hấp
Tai mũi họng
Tiêu hóa
Da liễu
Cơ xương khớp
Tim mạch
Nội tiết
Ung thư
Dinh dưỡng
Thần kinh
Hiếm muộn
Nhi - Sơ sinh
Tiết niệu - Nam học
Sản phụ khoa
Đời sốngBài học sốngTổ ấmTiêu dùngCookingMua sắm thông minh
Tại sao đàn ông nói dối về chiều cao\?
Tại sao đàn ông nói dối về chiều cao?
Đàn ông thích tăng thêm một hoặc hai cm vào chiều cao thực tế của mình và thường nói quá về chiều cao trên các ứng dụng hẹn hò. 

Những điều cần cân nhắc trước khi nghỉ việc
Khi ngày càng nhiều người bất mãn với công việc và muốn từ bỏ, bạn cần phải tỉnh táo để không bị cám dỗ và làm theo họ. 

Điều bất ngờ từ cuộc gọi vào điện thoại của con trai đã mất 23
Người trẻ bất mãn với guồng làm việc 9-5 24
Săn hàng 'bom' 22
Giáo dụcTin tứcTuyển sinhChân dungDu họcGiáo dục 4.0Trắc nghiệm
Nhiều đại học Mỹ thay đổi tiêu chí tuyển sinh
Nhiều đại học Mỹ thay đổi tiêu chí tuyển sinh
Không yêu cầu điểm SAT, nâng điểm IELTS hay yêu cầu ứng viên thể hiện khả năng giải quyết các tình huống thực tế là những thay đổi trong ... 

Dự kiến có 30 đại học trọng điểm ở Việt Nam
Việt Nam sẽ có 30 đại học trọng điểm, tiến vào các bảng xếp hạng thế giới, gồm 5 đại học quốc gia, 18-20 trường trọng điểm ngành và ... 

Nước Đông Nam Á nào có hồ núi lửa lớn nhất thế giới?
Nữ phó giáo sư người Việt dạy AI ở đại học top đầu Trung Quốc 106
Cô bé lớp một cõng bạn đến lớp 31
Trang chủVideoPodcastsẢnhInfographicsMới nhấtXem nhiềuTin nóng
Thời sựGóc nhìnThế giớiKinh doanhBất động sảnGiải trí
Thể thaoPháp luậtGiáo dụcSức khỏeĐời sốngDu lịch
Khoa họcSố hóaXeÝ kiếnTâm sựThư giãn
Rao vặtStartupMua ảnh VnExpresseBox
Tải ứng dụng

VnExpressInternational
Liên hệ

Tòa soạnQuảng cáoHợp tác bản quyền
Đường dây nóng

083.888.0123
(Hà Nội)

082.233.3555
(TP. Hồ Chí Minh)

Báo điện tử VnExpress - Bao tieng Viet nhieu nguoi xem nhat

Điều khoản sử dụng
Chính sách bảo mật
CookiesSkip to main content
Microsoft Ignite
Nov 14-17, 2023
Search

Sign in
Version
Search
Filter by title
ASP.NET Core documentation
Get started
Overview
Overview
Action return types
Handle JSON Patch requests
Format response data
Custom formatters
Analyzers
Conventions
Handle errors
Best practices
API reference
Contribute
Learn  .NET  ASP.NET Core 
Create web APIs with ASP.NET Core
Article
04/11/2023
15 contributors
In this article
ControllerBase class
Attributes
ApiController attribute
Attribute routing requirement
Show 6 more
ASP.NET Core supports creating web APIs using controllers or using minimal APIs. Controllers in a web API are classes that derive from ControllerBase. Controllers are activated and disposed on a per request basis.

This article shows how to use controllers for handling web API requests. For information on creating web APIs without controllers, see Tutorial: Create a minimal API with ASP.NET Core.

ControllerBase class
A controller-based web API consists of one or more controller classes that derive from ControllerBase. The web API project template provides a starter controller:

C#

Copy
[ApiController]
[Route("[controller]")]
public class WeatherForecastController : ControllerBase
Web API controllers should typically derive from ControllerBase rather from Controller. Controller derives from ControllerBase and adds support for views, so it's for handling web pages, not web API requests. If the same controller must support views and web APIs, derive from Controller.

The ControllerBase class provides many properties and methods that are useful for handling HTTP requests. For example, CreatedAtAction returns a 201 status code:

C#

Copy
[HttpPost]
[ProducesResponseType(StatusCodes.Status201Created)]
[ProducesResponseType(StatusCodes.Status400BadRequest)]
public ActionResult<Pet> Create(Pet pet)
{
    pet.Id = _petsInMemoryStore.Any() ? 
             _petsInMemoryStore.Max(p => p.Id) + 1 : 1;
    _petsInMemoryStore.Add(pet);

    return CreatedAtAction(nameof(GetById), new { id = pet.Id }, pet);
}
The following table contains examples of methods in ControllerBase.

Method	Notes
BadRequest	Returns 400 status code.
NotFound	Returns 404 status code.
PhysicalFile	Returns a file.
TryUpdateModelAsync	Invokes model binding.
TryValidateModel	Invokes model validation.
For a list of all available methods and properties, see ControllerBase.

Attributes
The Microsoft.AspNetCore.Mvc namespace provides attributes that can be used to configure the behavior of web API controllers and action methods. The following example uses attributes to specify the supported HTTP action verb and any known HTTP status codes that could be returned:

C#

Copy
[HttpPost]
[ProducesResponseType(StatusCodes.Status201Created)]
[ProducesResponseType(StatusCodes.Status400BadRequest)]
public ActionResult<Pet> Create(Pet pet)
{
    pet.Id = _petsInMemoryStore.Any() ? 
             _petsInMemoryStore.Max(p => p.Id) + 1 : 1;
    _petsInMemoryStore.Add(pet);

    return CreatedAtAction(nameof(GetById), new { id = pet.Id }, pet);
}
Here are some more examples of attributes that are available.

Attribute	Notes
[Route]	Specifies URL pattern for a controller or action.
[Bind]	Specifies prefix and properties to include for model binding.
[HttpGet]	Identifies an action that supports the HTTP GET action verb.
[Consumes]	Specifies data types that an action accepts.
[Produces]	Specifies data types that an action returns.
For a list that includes the available attributes, see the Microsoft.AspNetCore.Mvc namespace.

ApiController attribute
The [ApiController] attribute can be applied to a controller class to enable the following opinionated, API-specific behaviors:

Attribute routing requirement
Automatic HTTP 400 responses
Binding source parameter inference
Multipart/form-data request inference
Problem details for error status codes
Attribute on specific controllers
The [ApiController] attribute can be applied to specific controllers, as in the following example from the project template:

C#

Copy
[ApiController]
[Route("[controller]")]
public class WeatherForecastController : ControllerBase
Attribute on multiple controllers
One approach to using the attribute on more than one controller is to create a custom base controller class annotated with the [ApiController] attribute. The following example shows a custom base class and a controller that derives from it:

C#

Copy
[ApiController]
public class MyControllerBase : ControllerBase
{
}
C#

Copy
[Produces(MediaTypeNames.Application.Json)]
[Route("[controller]")]
public class PetsController : MyControllerBase
Attribute on an assembly
The [ApiController] attribute can be applied to an assembly. When the [ApiController] attribute is applied to an assembly, all controllers in the assembly have the [ApiController] attribute applied. There's no way to opt out for individual controllers. Apply the assembly-level attribute to the Program.cs file:

C#

Copy
using Microsoft.AspNetCore.Mvc;
[assembly: ApiController]

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers();

var app = builder.Build();

app.UseHttpsRedirection();

app.UseAuthorization();

app.MapControllers();

app.Run();
Attribute routing requirement
The [ApiController] attribute makes attribute routing a requirement. For example:

C#

Copy
[ApiController]
[Route("[controller]")]
public class WeatherForecastController : ControllerBase
Actions are inaccessible via conventional routes defined by UseEndpoints, UseMvc, or UseMvcWithDefaultRoute.

Automatic HTTP 400 responses
The [ApiController] attribute makes model validation errors automatically trigger an HTTP 400 response. Consequently, the following code is unnecessary in an action method:

C#

Copy
if (!ModelState.IsValid)
{
    return BadRequest(ModelState);
}
ASP.NET Core MVC uses the ModelStateInvalidFilter action filter to do the preceding check.

Default BadRequest response
The default response type for an HTTP 400 response is ValidationProblemDetails. The following response body is an example of the serialized type:

JSON

Copy
{
  "type": "https://tools.ietf.org/html/rfc7231#section-6.5.1",
  "title": "One or more validation errors occurred.",
  "status": 400,
  "traceId": "|7fb5e16a-4c8f23bbfc974667.",
  "errors": {
    "": [
      "A non-empty request body is required."
    ]
  }
}
The ValidationProblemDetails type:

Provides a machine-readable format for specifying errors in web API responses.
Complies with the RFC 7807 specification.
To make automatic and custom responses consistent, call the ValidationProblem method instead of BadRequest. ValidationProblem returns a ValidationProblemDetails object as well as the automatic response.

Log automatic 400 responses
To log automatic 400 responses, set the InvalidModelStateResponseFactory delegate property to perform custom processing. By default, InvalidModelStateResponseFactory uses ProblemDetailsFactory to create an instance of ValidationProblemDetails.

The following example shows how to retrieve an instance of ILogger<TCategoryName> to log information about an automatic 400 response:

C#

Copy
var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers()
    .ConfigureApiBehaviorOptions(options =>
    {
      // To preserve the default behavior, capture the original delegate to call later.
        var builtInFactory = options.InvalidModelStateResponseFactory;

        options.InvalidModelStateResponseFactory = context =>
        {
            var logger = context.HttpContext.RequestServices
                                .GetRequiredService<ILogger<Program>>();

            // Perform logging here.
            // ...

            // Invoke the default behavior, which produces a ValidationProblemDetails
            // response.
            // To produce a custom response, return a different implementation of 
            // IActionResult instead.
            return builtInFactory(context);
        };
    });

var app = builder.Build();

app.UseHttpsRedirection();

app.UseAuthorization();

app.MapControllers();

app.Run();
Disable automatic 400 response
To disable the automatic 400 behavior, set the SuppressModelStateInvalidFilter property to true. Add the following highlighted code:

C#

Copy
using Microsoft.AspNetCore.Mvc;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers()
    .ConfigureApiBehaviorOptions(options =>
    {
        options.SuppressConsumesConstraintForFormFileParameters = true;
        options.SuppressInferBindingSourcesForParameters = true;
        options.SuppressModelStateInvalidFilter = true;
        options.SuppressMapClientErrors = true;
        options.ClientErrorMapping[StatusCodes.Status404NotFound].Link =
            "https://httpstatuses.com/404";
    });

var app = builder.Build();

app.UseHttpsRedirection();

app.UseAuthorization();

app.MapControllers();

app.Run();
Binding source parameter inference
A binding source attribute defines the location at which an action parameter's value is found. The following binding source attributes exist:

Attribute	Binding source
[FromBody]	Request body
[FromForm]	Form data in the request body
[FromHeader]	Request header
[FromQuery]	Request query string parameter
[FromRoute]	Route data from the current request
[FromServices]	The request service injected as an action parameter
[AsParameters]	Method parameters
 Warning

Don't use [FromRoute] when values might contain %2f (that is /). %2f won't be unescaped to /. Use [FromQuery] if the value might contain %2f.

Without the [ApiController] attribute or binding source attributes like [FromQuery], the ASP.NET Core runtime attempts to use the complex object model binder. The complex object model binder pulls data from value providers in a defined order.

In the following example, the [FromQuery] attribute indicates that the discontinuedOnly parameter value is provided in the request URL's query string:

C#

Copy
[HttpGet]
public ActionResult<List<Product>> Get(
    [FromQuery] bool discontinuedOnly = false)
{
    List<Product> products = null;

    if (discontinuedOnly)
    {
        products = _productsInMemoryStore.Where(p => p.IsDiscontinued).ToList();
    }
    else
    {
        products = _productsInMemoryStore;
    }

    return products;
}
The [ApiController] attribute applies inference rules for the default data sources of action parameters. These rules save you from having to identify binding sources manually by applying attributes to the action parameters. The binding source inference rules behave as follows:

[FromServices] is inferred for complex type parameters registered in the DI Container.
[FromBody] is inferred for complex type parameters not registered in the DI Container. An exception to the [FromBody] inference rule is any complex, built-in type with a special meaning, such as IFormCollection and CancellationToken. The binding source inference code ignores those special types.
[FromForm] is inferred for action parameters of type IFormFile and IFormFileCollection. It's not inferred for any simple or user-defined types.
[FromRoute] is inferred for any action parameter name matching a parameter in the route template. When more than one route matches an action parameter, any route value is considered [FromRoute].
[FromQuery] is inferred for any other action parameters.
FromBody inference notes
[FromBody] isn't inferred for simple types such as string or int. Therefore, the [FromBody] attribute should be used for simple types when that functionality is needed.

When an action has more than one parameter bound from the request body, an exception is thrown. For example, all of the following action method signatures cause an exception:

[FromBody] inferred on both because they're complex types.

C#

Copy
[HttpPost]
public IActionResult Action1(Product product, Order order)
[FromBody] attribute on one, inferred on the other because it's a complex type.

C#

Copy
[HttpPost]
public IActionResult Action2(Product product, [FromBody] Order order)
[FromBody] attribute on both.

C#

Copy
[HttpPost]
public IActionResult Action3([FromBody] Product product, [FromBody] Order order)

FromServices inference notes
Parameter binding binds parameters through dependency injection when the type is configured as a service. This means it's not required to explicitly apply the [FromServices] attribute to a parameter. In the following code, both actions return the time:

C#

Copy
[Route("[controller]")]
[ApiController]
public class MyController : ControllerBase
{
    public ActionResult GetWithAttribute([FromServices] IDateTime dateTime) 
                                                        => Ok(dateTime.Now);

    [Route("noAttribute")]
    public ActionResult Get(IDateTime dateTime) => Ok(dateTime.Now);
}
In rare cases, automatic DI can break apps that have a type in DI that is also accepted in an API controller's action methods. It's not common to have a type in DI and as an argument in an API controller action.

To disable [FromServices] inference for a single action parameter, apply the desired binding source attribute to the parameter. For example, apply the [FromBody] attribute to an action parameter that should be bound from the body of the request.

To disable [FromServices] inference globally, set DisableImplicitFromServicesParameters to true:

C#

Copy
using Microsoft.AspNetCore.Mvc;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers();
builder.Services.AddSingleton<IDateTime, SystemDateTime>();

builder.Services.Configure<ApiBehaviorOptions>(options =>
{
    options.DisableImplicitFromServicesParameters = true;
});

var app = builder.Build();

app.MapControllers();

app.Run();
Types are checked at app startup with IServiceProviderIsService to determine if an argument in an API controller action comes from DI or from the other sources.

The mechanism to infer binding source of API Controller action parameters uses the following rules:

A previously specified BindingInfo.BindingSource is never overwritten.
A complex type parameter, registered in the DI container, is assigned BindingSource.Services.
A complex type parameter, not registered in the DI container, is assigned BindingSource.Body.
A parameter with a name that appears as a route value in any route template is assigned BindingSource.Path.
All other parameters are BindingSource.Query.
Disable inference rules
To disable binding source inference, set SuppressInferBindingSourcesForParameters to true:

C#

Copy
using Microsoft.AspNetCore.Mvc;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers()
    .ConfigureApiBehaviorOptions(options =>
    {
        options.SuppressConsumesConstraintForFormFileParameters = true;
        options.SuppressInferBindingSourcesForParameters = true;
        options.SuppressModelStateInvalidFilter = true;
        options.SuppressMapClientErrors = true;
        options.ClientErrorMapping[StatusCodes.Status404NotFound].Link =
            "https://httpstatuses.com/404";
        options.DisableImplicitFromServicesParameters = true;
    });

var app = builder.Build();

app.UseHttpsRedirection();

app.UseAuthorization();

app.MapControllers();

app.Run();
Multipart/form-data request inference
The [ApiController] attribute applies an inference rule for action parameters of type IFormFile and IFormFileCollection. The multipart/form-data request content type is inferred for these types.

To disable the default behavior, set the SuppressConsumesConstraintForFormFileParameters property to true:

C#

Copy
using Microsoft.AspNetCore.Mvc;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers()
    .ConfigureApiBehaviorOptions(options =>
    {
        options.SuppressConsumesConstraintForFormFileParameters = true;
        options.SuppressInferBindingSourcesForParameters = true;
        options.SuppressModelStateInvalidFilter = true;
        options.SuppressMapClientErrors = true;
        options.ClientErrorMapping[StatusCodes.Status404NotFound].Link =
            "https://httpstatuses.com/404";
    });

var app = builder.Build();

app.UseHttpsRedirection();

app.UseAuthorization();

app.MapControllers();

app.Run();
Problem details for error status codes
MVC transforms an error result (a result with status code 400 or higher) to a result with ProblemDetails. The ProblemDetails type is based on the RFC 7807 specification for providing machine-readable error details in an HTTP response.

Consider the following code in a controller action:

C#

Copy
if (pet == null)
{
    return NotFound();
}
The NotFound method produces an HTTP 404 status code with a ProblemDetails body. For example:

JSON

Copy
{
  type: "https://tools.ietf.org/html/rfc7231#section-6.5.4",
  title: "Not Found",
  status: 404,
  traceId: "0HLHLV31KRN83:00000001"
}
Disable ProblemDetails response
The automatic creation of a ProblemDetails for error status codes is disabled when the SuppressMapClientErrors property is set to true. Add the following code:

C#

Copy
using Microsoft.AspNetCore.Mvc;

var builder = WebApplication.CreateBuilder(args);

builder.Services.AddControllers()
    .ConfigureApiBehaviorOptions(options =>
    {
        options.SuppressConsumesConstraintForFormFileParameters = true;
        options.SuppressInferBindingSourcesForParameters = true;
        options.SuppressModelStateInvalidFilter = true;
        options.SuppressMapClientErrors = true;
        options.ClientErrorMapping[StatusCodes.Status404NotFound].Link =
            "https://httpstatuses.com/404";
    });

var app = builder.Build();

app.UseHttpsRedirection();

app.UseAuthorization();

app.MapControllers();

app.Run();

Define supported request content types with the [Consumes] attribute
By default, an action supports all available request content types. For example, if an app is configured to support both JSON and XML input formatters, an action supports multiple content types, including application/json and application/xml.

The [Consumes] attribute allows an action to limit the supported request content types. Apply the [Consumes] attribute to an action or controller, specifying one or more content types:

C#

Copy
[HttpPost]
[Consumes("application/xml")]
public IActionResult CreateProduct(Product product)
In the preceding code, the CreateProduct action specifies the content type application/xml. Requests routed to this action must specify a Content-Type header of application/xml. Requests that don't specify a Content-Type header of application/xml result in a 415 Unsupported Media Type response.

The [Consumes] attribute also allows an action to influence its selection based on an incoming request's content type by applying a type constraint. Consider the following example:

C#

Copy
[ApiController]
[Route("api/[controller]")]
public class ConsumesController : ControllerBase
{
    [HttpPost]
    [Consumes("application/json")]
    public IActionResult PostJson(IEnumerable<int> values) =>
        Ok(new { Consumes = "application/json", Values = values });

    [HttpPost]
    [Consumes("application/x-www-form-urlencoded")]
    public IActionResult PostForm([FromForm] IEnumerable<int> values) =>
        Ok(new { Consumes = "application/x-www-form-urlencoded", Values = values });
}
In the preceding code, ConsumesController is configured to handle requests sent to the https://localhost:5001/api/Consumes URL. Both of the controller's actions, PostJson and PostForm, handle POST requests with the same URL. Without the [Consumes] attribute applying a type constraint, an ambiguous match exception is thrown.

The [Consumes] attribute is applied to both actions. The PostJson action handles requests sent with a Content-Type header of application/json. The PostForm action handles requests sent with a Content-Type header of application/x-www-form-urlencoded.

Additional resources
View or download sample code. (How to download).
Controller action return types in ASP.NET Core web API
Handle errors in ASP.NET Core web APIs
Custom formatters in ASP.NET Core Web API
Format response data in ASP.NET Core Web API
ASP.NET Core web API documentation with Swagger / OpenAPI
Routing to controller actions in ASP.NET Core
Use port tunneling Visual Studio to debug web APIs
Create a web API with ASP.NET Core
 Collaborate with us on GitHub
The source for this content can be found on GitHub, where you can also create and review issues and pull requests. For more information, see our contributor guide.

ASP.NET Core feedback

The ASP.NET Core documentation is open source. Provide feedback here.

 Open a documentation issue
 Provide product feedback
Additional resources
Training

Module

Create a web API with ASP.NET Core controllers - Training
Create a RESTful service with ASP.NET Core controllers that supports create, read, update, delete (CRUD) operations.

Documentation

Tutorial: Create a web API with ASP.NET Core
Learn how to build a web API with ASP.NET Core.

Tutorial: Create a minimal API with ASP.NET Core
Learn how to build a minimal API with ASP.NET Core.

Create a web API with ASP.NET Core and MongoDB
This tutorial demonstrates how to create an ASP.NET Core web API using a MongoDB NoSQL database.

Show 5 more
Previous Versions
Blog
Contribute
Privacy
Terms of Use
Trademarks
© Microsoft 2023

RSS
Theo dõi VnExpress trên
Báo tiếng Việt nhiều người xem nhất
Thuộc Bộ Khoa học và Công nghệ
Số giấy phép: 548/GP-BTTTT ngày 24/08/2021

Tổng biên tập: Phạm Hiếu
Địa chỉ: Tầng 10, Tòa A FPT Tower, số 10 Phạm Văn Bạch, Dịch Vọng, Cầu Giấy, Hà Nội
Điện thoại: 024 7300 8899 - máy lẻ 4500

© 1997-2023. Toàn bộ bản quyền thuộc VnExpress